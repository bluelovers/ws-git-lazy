"use strict";
/**
 * Created by user on 2018/5/15/015.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const uni_string_1 = require("uni-string");
function encode(s) {
    return uni_string_1.default.split(s, '')
        .map(function (v) {
        let s = Buffer.from(v);
        if (s.length > 1 || (s.length == 1 && s[0] >= 0x7F)) {
            let t = '';
            for (let b of s.entries()) {
                t = t + '\\' + b[1].toString(8);
            }
            return t;
        }
        return v;
    })
        .join('');
}
exports.encode = encode;
function decode(s) {
    let matches = [];
    let t = '';
    let i2 = 0, b = [];
    let arr;
    let r = /(?:\\(\d{3}))/g;
    while (arr = r.exec(s)) {
        //let extras = arr.splice(-2);
        /*
         arr.i2 = i2;
         arr.lastIndex = r.lastIndex;
         console.log([arr, s.length, t, b, s.substr(i2, arr.index)]);
         */
        if (i2 != arr.index) {
            if (b.length) {
                t += Buffer.from(b).toString();
                b = [];
            }
            t += s.substr(i2, arr.index - i2);
        }
        //i2 = arr.index + arr[0].length;
        i2 = r.lastIndex;
        b.push(parseInt(arr[1], 8));
    }
    //console.log([t, b]);
    if (b.length) {
        t += Buffer.from(b).toString();
        b = [];
    }
    if (i2 > -1 && i2 < s.length) {
        t += s.substr(i2, s.length - i2);
    }
    return t;
}
exports.decode = decode;
const self = require("./index");
exports.default = self;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7O0FBRUgsMkNBQWlDO0FBRWpDLFNBQWdCLE1BQU0sQ0FBQyxDQUFTO0lBRS9CLE9BQU8sb0JBQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQztTQUN6QixHQUFHLENBQUMsVUFBVSxDQUFDO1FBRWQsSUFBSSxDQUFDLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUV2QixJQUFJLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxFQUNuRDtZQUNDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUVYLEtBQUssSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUN6QjtnQkFDQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ2hDO1lBRUQsT0FBTyxDQUFDLENBQUM7U0FDVDtRQUVELE9BQU8sQ0FBQyxDQUFDO0lBQ1YsQ0FBQyxDQUNEO1NBQ0EsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUNSO0FBQ0gsQ0FBQztBQXhCRCx3QkF3QkM7QUFFRCxTQUFnQixNQUFNLENBQUMsQ0FBQztJQUV2QixJQUFJLE9BQU8sR0FBRyxFQUFFLENBQUM7SUFFakIsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBQ1gsSUFBSSxFQUFFLEdBQUcsQ0FBQyxFQUNQLENBQUMsR0FBRyxFQUFFLENBQ1I7SUFFRCxJQUFJLEdBQUcsQ0FBQztJQUNSLElBQUksQ0FBQyxHQUFHLGdCQUFnQixDQUFDO0lBRXpCLE9BQU8sR0FBRyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQ3RCO1FBQ0MsOEJBQThCO1FBRTlCOzs7O1dBSUc7UUFFSCxJQUFJLEVBQUUsSUFBSSxHQUFHLENBQUMsS0FBSyxFQUNuQjtZQUVDLElBQUksQ0FBQyxDQUFDLE1BQU0sRUFDWjtnQkFDQyxDQUFDLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztnQkFDL0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQzthQUNQO1lBRUQsQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLEdBQUcsQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDLENBQUM7U0FDbEM7UUFFRCxpQ0FBaUM7UUFDakMsRUFBRSxHQUFHLENBQUMsQ0FBQyxTQUFTLENBQUM7UUFFakIsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDNUI7SUFFRCxzQkFBc0I7SUFFdEIsSUFBSSxDQUFDLENBQUMsTUFBTSxFQUNaO1FBQ0MsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDL0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQztLQUNQO0lBRUQsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQyxNQUFNLEVBQzVCO1FBQ0MsQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDLENBQUM7S0FDakM7SUFFRCxPQUFPLENBQUMsQ0FBQztBQUNWLENBQUM7QUF0REQsd0JBc0RDO0FBRUQsZ0NBQWdDO0FBRWhDLGtCQUFlLElBQUksQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSB1c2VyIG9uIDIwMTgvNS8xNS8wMTUuXG4gKi9cblxuaW1wb3J0IFVTdHJpbmcgZnJvbSAndW5pLXN0cmluZyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBlbmNvZGUoczogc3RyaW5nKVxue1xuXHRyZXR1cm4gVVN0cmluZy5zcGxpdChzLCAnJylcblx0XHQubWFwKGZ1bmN0aW9uICh2KVxuXHRcdFx0e1xuXHRcdFx0XHRsZXQgcyA9IEJ1ZmZlci5mcm9tKHYpO1xuXG5cdFx0XHRcdGlmIChzLmxlbmd0aCA+IDEgfHwgKHMubGVuZ3RoID09IDEgJiYgc1swXSA+PSAweDdGKSlcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGxldCB0ID0gJyc7XG5cblx0XHRcdFx0XHRmb3IgKGxldCBiIG9mIHMuZW50cmllcygpKVxuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdHQgPSB0ICsgJ1xcXFwnICsgYlsxXS50b1N0cmluZyg4KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gdDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiB2O1xuXHRcdFx0fVxuXHRcdClcblx0XHQuam9pbignJylcblx0XHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWNvZGUocylcbntcblx0bGV0IG1hdGNoZXMgPSBbXTtcblxuXHRsZXQgdCA9ICcnO1xuXHRsZXQgaTIgPSAwXG5cdFx0LCBiID0gW11cblx0O1xuXG5cdGxldCBhcnI7XG5cdGxldCByID0gLyg/OlxcXFwoXFxkezN9KSkvZztcblxuXHR3aGlsZSAoYXJyID0gci5leGVjKHMpKVxuXHR7XG5cdFx0Ly9sZXQgZXh0cmFzID0gYXJyLnNwbGljZSgtMik7XG5cblx0XHQvKlxuXHRcdCBhcnIuaTIgPSBpMjtcblx0XHQgYXJyLmxhc3RJbmRleCA9IHIubGFzdEluZGV4O1xuXHRcdCBjb25zb2xlLmxvZyhbYXJyLCBzLmxlbmd0aCwgdCwgYiwgcy5zdWJzdHIoaTIsIGFyci5pbmRleCldKTtcblx0XHQgKi9cblxuXHRcdGlmIChpMiAhPSBhcnIuaW5kZXgpXG5cdFx0e1xuXG5cdFx0XHRpZiAoYi5sZW5ndGgpXG5cdFx0XHR7XG5cdFx0XHRcdHQgKz0gQnVmZmVyLmZyb20oYikudG9TdHJpbmcoKTtcblx0XHRcdFx0YiA9IFtdO1xuXHRcdFx0fVxuXG5cdFx0XHR0ICs9IHMuc3Vic3RyKGkyLCBhcnIuaW5kZXggLSBpMik7XG5cdFx0fVxuXG5cdFx0Ly9pMiA9IGFyci5pbmRleCArIGFyclswXS5sZW5ndGg7XG5cdFx0aTIgPSByLmxhc3RJbmRleDtcblxuXHRcdGIucHVzaChwYXJzZUludChhcnJbMV0sIDgpKTtcblx0fVxuXG5cdC8vY29uc29sZS5sb2coW3QsIGJdKTtcblxuXHRpZiAoYi5sZW5ndGgpXG5cdHtcblx0XHR0ICs9IEJ1ZmZlci5mcm9tKGIpLnRvU3RyaW5nKCk7XG5cdFx0YiA9IFtdO1xuXHR9XG5cblx0aWYgKGkyID4gLTEgJiYgaTIgPCBzLmxlbmd0aClcblx0e1xuXHRcdHQgKz0gcy5zdWJzdHIoaTIsIHMubGVuZ3RoIC0gaTIpO1xuXHR9XG5cblx0cmV0dXJuIHQ7XG59XG5cbmltcG9ydCAqIGFzIHNlbGYgZnJvbSAnLi9pbmRleCc7XG5cbmV4cG9ydCBkZWZhdWx0IHNlbGY7XG5cbiJdfQ==